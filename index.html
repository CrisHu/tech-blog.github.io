<!DOCTYPE html>






  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">











<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=6.2.0">


  <link rel="mask-icon" href="/images/favicon.ico?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="なthing $erious">
<meta name="keywords" content="tech thinking">
<meta property="og:type" content="website">
<meta property="og:title" content="PL03188198">
<meta property="og:url" content="http://huile.moe/index.html">
<meta property="og:site_name" content="PL03188198">
<meta property="og:description" content="なthing $erious">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PL03188198">
<meta name="twitter:description" content="なthing $erious">



  <link rel="alternate" href="/atom.xml" title="PL03188198" type="application/atom+xml" />




  <link rel="canonical" href="http://huile.moe/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>PL03188198</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
    <a href="https://github.com/CrisHu" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#222; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">PL03188198</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huile.moe/记录两天的面试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="huile">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/favicon.ico">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PL03188198">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/记录两天的面试/" itemprop="url">
                  记录两天的面试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-08-25 06:59:20 / Modified: 11:49:16" itemprop="dateCreated datePublished" datetime="2018-08-25T06:59:20+08:00">2018-08-25</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="8-23"><a href="#8-23" class="headerlink" title="8-23"></a>8-23</h2><h3 id="hupu"><a href="#hupu" class="headerlink" title="hupu"></a>hupu</h3><p>公司背景: 虎扑体育, 现在正处于篮球社区向直男社区转变的道路上</p>
<p>公司技术栈: 后端主要语言为java, 同时为了增加社区内容, 在发展python爬虫</p>
<p>面试岗位: pythong开发(由于hr的问题, 直接被刷掉了, 毕竟根本不会爬虫)</p>
<p>面试经历: 这个过程很轻松, 面试官人很好, 一开始的沟通过程中我们俩就发现岗位和技术栈的出入, 于是面试官就提前说清楚了, 随便聊了1个多小时。哈, 面试官真的人很好, 最后送我走后加了微信, 还说要帮我介绍工作～下面是具体的面试内容(个人觉得这几个问题还是比较有趣的)</p>
<h4 id="1-你为什么选择python"><a href="#1-你为什么选择python" class="headerlink" title="1. 你为什么选择python"></a>1. 你为什么选择python</h4><p>这个就很开放性了, 但是作为资深python开发, 不要扯太多python的禅意, 应该把python与更多的主流语言做对比, 例如可以夸一夸python的社区发展、市场前景(面试官也提到ruby on rails 成功在先)、语言特性等</p>
<p>同时最好也深刻认识到python的缺点, 毕竟现在很多大企业都在用python, 同时他们也在将python向其他语言方向转</p>
<h4 id="2-协程的产生历史-协程的应用"><a href="#2-协程的产生历史-协程的应用" class="headerlink" title="2. 协程的产生历史 协程的应用"></a>2. 协程的产生历史 协程的应用</h4><p>这个问题我们放到后面讨论(它及其的关键 以至于每次面试基本上都会被问到)</p>
<h4 id="3-谈天说地"><a href="#3-谈天说地" class="headerlink" title="3.谈天说地"></a>3.谈天说地</h4><p>主要就是一些产品问题, 讨论了比较好玩的即刻app; 同时也给了一些建设性建议, 去学一门静态语言</p>
<h3 id="便利蜂"><a href="#便利蜂" class="headerlink" title="便利蜂"></a>便利蜂</h3><p>公司背景: 新零售, 上海团队主要负责将各种算法api, 识别技术产品落地, 工程化</p>
<p>公司技术栈: 没有太了解, 2-3个人负责一个python后端, 并发以及流量应该都不大</p>
<p>面试经历: 技术负责人以及hr一起面试的, 整个过程也算轻松, 介绍完自己后就问了几个基础的业务场景解决方案以及针对简历问了一点弱弱的问题, 下面是一些还好的问题吧</p>
<h4 id="1-es的实现"><a href="#1-es的实现" class="headerlink" title="1. es的实现"></a>1. es的实现</h4><p>这里我只知道es核心是lucene搜索, 倒排索引相关的结构以及工作模式</p>
<h4 id="2-hashmap的实现"><a href="#2-hashmap的实现" class="headerlink" title="2. hashmap的实现"></a>2. hashmap的实现</h4><p>这个东西不管什么语言都差不多, 讲一下hash算法以及什么情况下rehash就好啦<br>(这里就很巧了, 面试后和朋友聊天讨论到了有序字典的实现, 结果后面某家单位就问到了)</p>
<h3 id="字节跳动"><a href="#字节跳动" class="headerlink" title="字节跳动"></a>字节跳动</h3><p>公司背景: 抖音……(太强了, 内心很向往, 如果能入职这家公司, 先不谈技术的提高, 我甚至觉得对全球主流文化的走向, 互联网产品的新定义以及设计, 都能有一个长远的认识)</p>
<p>公司技术栈: flask mysql redis es 微服务 新型数据库(否则一些业务场景解决模式想不出来)</p>
<p>面试经历: 工作环境很骚啊……整个人还是比较紧张的; 面试官也是很年轻的(同龄人人比人吓死人), 问的问题非常具体以及细节. 个人觉得表现的非常不好! 最恐怖的是上网搜索了很多流出来的面试题, 算法方面要求真的很高, 没办法, 迫于压力都去背答案去了, 可是实际面试却没有问…</p>
<h4 id="1-redis各命令的实现"><a href="#1-redis各命令的实现" class="headerlink" title="1. redis各命令的实现"></a>1. redis各命令的实现</h4><p>简历上写的熟悉redis底层数据结构不抓瞎, 但是没想到会问到具体命令的时间复杂度……<br>问了几个例子吧, zset的zrange命令时间复杂度, 我知道的是这个命令执行肯定是用的zset的跳表部分, 但是具体复杂度就不知道了; zset的zscore, 这里了解到这个命令执行肯定是用的zset的字典部分, 就O(1)吧</p>
<h4 id="2-es的实现-核心-高可用解决方案等等"><a href="#2-es的实现-核心-高可用解决方案等等" class="headerlink" title="2. es的实现, 核心, 高可用解决方案等等"></a>2. es的实现, 核心, 高可用解决方案等等</h4><h4 id="3-协程-线程-进程应用场景"><a href="#3-协程-线程-进程应用场景" class="headerlink" title="3. 协程, 线程, 进程应用场景"></a>3. 协程, 线程, 进程应用场景</h4><p>用python的人一定要理解这三者的特性以及差别: 在这里总结一下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 进程间数据无法互通(或者说互通很麻烦, 要用池子啊, 管道什么的), 主流的做法往往是使用redis作为中间件, 辅助进程间数据交互</span><br><span class="line">2. 线程间数据通信就很方便了, 但是要用到锁, 维护起来可能更加烦人吧……线程的事件发生, 切换是在操作系统内核级别的, 所以开销很大, 同时现在用的python是cpython, 这就有一个很大的问题GIL</span><br><span class="line">3. 协程又叫做纤程, 轻量级线程, 它是在线程内管理的, 一个单线程的进程可以同时使用上万的协程; 每一个协程维护自己寄存器上下文以及栈状态; 协程的切换是在线程内进行的, 切换开销小; 协程可以主动让出执行权, 距离例子: 使用协程的生产者消费者模式更加高效; 同时协程还有多个出口和入口, 结合之前的特点, 线程管理协程, 用户操作协程更加的灵活</span><br><span class="line">4. 一般来说多进程, 多线程, 还是单协程处理网络io的多任务时都是很高效的, 但是对于cpu io就不起作用了. 但是协程的一个封装gevent可以高效的解决这个方案</span><br><span class="line">5. 最高效的解决方案, 多进程+协程(多个进程通过主线程去使用协程)</span><br></pre></td></tr></table></figure></p>
<h4 id="4-mysql索引的数据结构-innodb"><a href="#4-mysql索引的数据结构-innodb" class="headerlink" title="4. mysql索引的数据结构(innodb)"></a>4. mysql索引的数据结构(innodb)</h4><p>两种就好, 聚簇索引和非聚簇索引(老生长谈的话题, 吹就完事了)<br>如果对这方面不了解, 强烈推荐微信公众号’我们都是小青蛙’的微信文章, 会从数据行格式开始, 数据页直到索引, 透彻的给你讲清楚</p>
<h4 id="5-高可用问题"><a href="#5-高可用问题" class="headerlink" title="5. 高可用问题"></a>5. 高可用问题</h4><p>没有这方面的工作经验, 吹都吹不出来啊</p>
<h2 id="8-24"><a href="#8-24" class="headerlink" title="8-24"></a>8-24</h2><h3 id="谷露软件"><a href="#谷露软件" class="headerlink" title="谷露软件"></a>谷露软件</h3><p>公司背景: 低调的to b公司, 产品面向企业; 氛围好, 工作环境也不错, a轮200人左右; 产品是面向更加优质化的招聘服务</p>
<p>公司技术栈: python es mysql redis</p>
<p>面试经历: 这个过程还是比较快乐的, 三轮面试, 两个技术面, 一个hr面; 第一位技术主要问了一些基础的python、mysql知识; 第二位技术负责人主要从架构, 程序的角度发问; 最后hr面试主要问一些团队要求以及自己的职业规划</p>
<h4 id="1-mysql一些冷门语句-having"><a href="#1-mysql一些冷门语句-having" class="headerlink" title="1. mysql一些冷门语句 having"></a>1. mysql一些冷门语句 having</h4><h4 id="2-python有序字典的实现"><a href="#2-python有序字典的实现" class="headerlink" title="2. python有序字典的实现"></a>2. python有序字典的实现</h4><p>就是字典对象在维护一个fifo的队列啦(list)</p>
<h4 id="3-python-运算符重载-迭代器实现"><a href="#3-python-运算符重载-迭代器实现" class="headerlink" title="3. python 运算符重载, 迭代器实现"></a>3. python 运算符重载, 迭代器实现</h4><p>就是重写那几个魔术方法呗</p>
<h3 id="小红书"><a href="#小红书" class="headerlink" title="小红书"></a>小红书</h3><p>公司背景: 聊天社交软件 其中也包含电商 算是很火的app了 技术栈深 或许以上公司中仅次于抖音</p>
<p>公司技术栈: flask 微服务架构 rpc mysql redis es</p>
<p>面试经历: 整三轮技术面试, 质量很高, 过程也很愉快~分别考察了: 架构 算法(面试前做了不少算法题 结果最基础的还是被挑刺了) 学习能力; 设计解决方案 写代码; 基础 用户会话保持 库表设计 负载均衡的理解。整个过程技术深度, 业务理解都有考察, 三个小时真的很考验人</p>
<h4 id="1-归并排序-二分查找-快速排序"><a href="#1-归并排序-二分查找-快速排序" class="headerlink" title="1. 归并排序 二分查找 快速排序"></a>1. 归并排序 二分查找 快速排序</h4><h4 id="2-库表设计-业务模型是记录用户在整个产品中所有的行为-应在对那些数据进行统计-在哪里埋点等的思考"><a href="#2-库表设计-业务模型是记录用户在整个产品中所有的行为-应在对那些数据进行统计-在哪里埋点等的思考" class="headerlink" title="2. 库表设计 业务模型是记录用户在整个产品中所有的行为, 应在对那些数据进行统计, 在哪里埋点等的思考"></a>2. 库表设计 业务模型是记录用户在整个产品中所有的行为, 应在对那些数据进行统计, 在哪里埋点等的思考</h4><h4 id="3-写出所看过的原码的整体细节"><a href="#3-写出所看过的原码的整体细节" class="headerlink" title="3. 写出所看过的原码的整体细节"></a>3. 写出所看过的原码的整体细节</h4><h4 id="4-项目架构的设计流以及代码实现"><a href="#4-项目架构的设计流以及代码实现" class="headerlink" title="4. 项目架构的设计流以及代码实现"></a>4. 项目架构的设计流以及代码实现</h4><h4 id="5-给出一个具体的需求-文章分词-设计解决方案并代码实现"><a href="#5-给出一个具体的需求-文章分词-设计解决方案并代码实现" class="headerlink" title="5. 给出一个具体的需求 文章分词 设计解决方案并代码实现"></a>5. 给出一个具体的需求 文章分词 设计解决方案并代码实现</h4><h4 id="6-上述问题上升到海量数据又应该怎么处理"><a href="#6-上述问题上升到海量数据又应该怎么处理" class="headerlink" title="6. 上述问题上升到海量数据又应该怎么处理"></a>6. 上述问题上升到海量数据又应该怎么处理</h4><h4 id="7-redis-5种类型的底层数据结构-持久化技术"><a href="#7-redis-5种类型的底层数据结构-持久化技术" class="headerlink" title="7. redis 5种类型的底层数据结构 持久化技术"></a>7. redis 5种类型的底层数据结构 持久化技术</h4><h4 id="8-mysql索引"><a href="#8-mysql索引" class="headerlink" title="8. mysql索引"></a>8. mysql索引</h4><h4 id="7-高并发服务负载均衡怎么设计"><a href="#7-高并发服务负载均衡怎么设计" class="headerlink" title="7. 高并发服务负载均衡怎么设计"></a>7. 高并发服务负载均衡怎么设计</h4><h4 id="8-在上述高并发服务下用户会话怎么保持"><a href="#8-在上述高并发服务下用户会话怎么保持" class="headerlink" title="8. 在上述高并发服务下用户会话怎么保持"></a>8. 在上述高并发服务下用户会话怎么保持</h4><h4 id="9-类微博的库表设计-er图-sql语句"><a href="#9-类微博的库表设计-er图-sql语句" class="headerlink" title="9. 类微博的库表设计 er图 sql语句"></a>9. 类微博的库表设计 er图 sql语句</h4><h1 id="把这两天的面试经历记录下来-希望能帮助到别人-自己也能从中受益"><a href="#把这两天的面试经历记录下来-希望能帮助到别人-自己也能从中受益" class="headerlink" title="把这两天的面试经历记录下来 希望能帮助到别人 自己也能从中受益"></a>把这两天的面试经历记录下来 希望能帮助到别人 自己也能从中受益</h1>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huile.moe/build-elk-in-docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="huile">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/favicon.ico">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PL03188198">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/build-elk-in-docker/" itemprop="url">
                  Build ELK in Docker
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-29 18:00:00" itemprop="dateCreated datePublished" datetime="2018-05-29T18:00:00+08:00">2018-05-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-08-25 06:53:33" itemprop="dateModified" datetime="2018-08-25T06:53:33+08:00">2018-08-25</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Before-build"><a href="#Before-build" class="headerlink" title="Before build"></a>Before build</h2><p>There is a virtual work scene.The data is fast growth, caused mysql can&apos;t meet the needs of searching from huge data immediately. Just like using &apos;like&apos; in mysql select from millions of users data by &apos;user_name&apos; could cause service halt or request timeout. In order to adjust new demand such like this situation in modern IT work, the traditional SQL have been replaced partly by the elasticsearch which is a highly scalable open-source full-text search and analytics engine.Use it for the first time,let us think es as traditional db can store data.In this doc we just use it without introduction and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="noopener">the full document(6.2.4)</a> is here(other softwares&apos; offical doc will be also paste out).<br>When you elasticsearch env has been built, there is a GUI console to interact with the port:9200 called <a href="https://www.elastic.co/guide/en/kibana/current/index.html" target="_blank" rel="noopener">Kinbana(6.2.4)</a> makes you use rest-api efficently.<br>And sometimes old web release system can&apos;t be stoped, so in the above case we would use <a href="https://www.elastic.co/guide/en/logstash/current/index.html" target="_blank" rel="noopener">Logstash(6.2.4)</a> to solve data consistency between mysql and new elasticsearch cluster.<br>My build env is on MacOS with 16G Mem, and the ELK docker structure is as blow.<br><img src="/build-elk-in-docker/structure.jpg"></p>
<h2 id="ES-cluster"><a href="#ES-cluster" class="headerlink" title="ES cluster"></a>ES cluster</h2><p>Above all, we should create a new network:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create network_es</span><br></pre></td></tr></table></figure></p>
<p>It is a virtual network for elk partner interacting each other conveniently.<br>And pull the ES image from dockerhub:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull docker.elastic.co/elasticsearch/elasticsearch:6.2.4</span><br></pre></td></tr></table></figure></p>
<p>Let us run our first elasticsearch container is as master node:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name es<span class="_">-a</span> --network network_es -p 127.0.0.1:9200:9200 -p 127.0.0.1:9300:9300 --memory=<span class="string">"2G"</span> -e ES_JAVA_OPTS=<span class="string">"-Xms1G -Xmx1G"</span> -e ELASTIC_PASSWORD=MagicWord -v /Users/your_name/db/es/es_conf/es-a.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /Users/your_name/db/es/es<span class="_">-a</span>:/usr/share/elasticsearch/data docker.elastic.co/elasticsearch/elasticsearch:6.2.4</span><br></pre></td></tr></table></figure></p>
<p>The above docker command run an elasticsearch container, which is in network named network_es. Only ports 9200 and 9300 are opened that the first port 9200 for receiving requests and the 9300 for nodes communication. The &apos;–memory=”2G”&apos; part is statement for this container&apos;s memory cache is 2G. The next parameter &apos;ES_JAVA_OPTS=”-Xms1G -Xmx1G”&apos; sets java heap space bacause of elasticsearch runing on the jvm env. And then the rest parameters are simple just like setting elasticsearch authentication password, mounting config files, data local store and assigning the elasticsearch image. The rest nodes are different in name and config.yml runed by:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name es-b --network network_es -p 127.0.0.1:9201:9200 -p 127.0.0.1:9301:9300 --memory=<span class="string">"2G"</span> -e ES_JAVA_OPTS=<span class="string">"-Xms1G -Xmx1G"</span> -e ELASTIC_PASSWORD=MagicWord -v /Users/your_name/db/es/es_conf/es-b.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /Users/your_name/db/es/es-b:/usr/share/elasticsearch/data docker.elastic.co/elasticsearch/elasticsearch:6.2.4</span><br><span class="line">docker run -d --name es-c --network network_es -p 127.0.0.1:9202:9200 -p 127.0.0.1:9302:9300 --memory=<span class="string">"2G"</span> -e ES_JAVA_OPTS=<span class="string">"-Xms1G -Xmx1G"</span> -e ELASTIC_PASSWORD=MagicWord -v /Users/your_name/db/es/es_conf/es-c.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /Users/your_name/db/es/es-c:/usr/share/elasticsearch/data docker.elastic.co/elasticsearch/elasticsearch:6.2.4</span><br></pre></td></tr></table></figure></p>
<p>There are three docker commands to run elasticsearch nodes and what counts is the config.yml files show us how does the elasticsearch cluster distinguish master or slave node between total nodes and make them to be one elasticsearch from the outside.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">es-a.yml</span><br><span class="line"></span><br><span class="line">cluster.name: <span class="string">"es_cluster"</span>    <span class="comment"># cluster name</span></span><br><span class="line">node.name: master    <span class="comment"># node a is named master</span></span><br><span class="line">node.master: <span class="literal">true</span>    <span class="comment"># it is the master</span></span><br><span class="line">node.data: <span class="literal">true</span>    <span class="comment"># it stores data</span></span><br><span class="line">network.bind_host: 0.0.0.0    <span class="comment"># the service is open to all</span></span><br><span class="line">network.publish_host: es<span class="_">-a</span>    <span class="comment"># host name</span></span><br><span class="line"></span><br><span class="line">es-b.yml</span><br><span class="line"></span><br><span class="line">cluster.name: <span class="string">"es_cluster"</span></span><br><span class="line">node.name: node</span><br><span class="line">node.master: <span class="literal">false</span></span><br><span class="line">network.bind_host: 0.0.0.0</span><br><span class="line">network.publish_host: es-b</span><br><span class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"es-a"</span>]    <span class="comment"># es function discovery</span></span><br><span class="line"></span><br><span class="line">es-c.yml</span><br><span class="line"></span><br><span class="line">cluster.name: <span class="string">"es_cluster"</span></span><br><span class="line">node.name: node</span><br><span class="line">node.master: <span class="literal">false</span></span><br><span class="line">network.bind_host: 0.0.0.0</span><br><span class="line">network.publish_host: es-c</span><br><span class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"es-a"</span>]</span><br></pre></td></tr></table></figure></p>
<p>With the docker running, ES containers also start up. The next, we use command &apos;curl&apos; to test the es running status:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">'http:/es-a:9200/_cat/health?v'</span></span><br><span class="line">epoch      timestamp cluster       status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent</span><br><span class="line">1528080741 10:52:21  elasticsearch green           1         1      5   5    0    0        0             0                  -                100.0%</span><br></pre></td></tr></table></figure></p>
<p>BTW, if u want to build es without docker, please add a new user to startup es for that root user can not.</p>
<h2 id="Kibana-amp-Logstash"><a href="#Kibana-amp-Logstash" class="headerlink" title="Kibana &amp; Logstash"></a>Kibana &amp; Logstash</h2><p>docker part<br>kibana install &amp; config &amp; test<br>logstash install &amp; config &amp; test</p>
<h2 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h2><p>Fighting!</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/favicon.ico"
                alt="huile" />
            
              <p class="site-author-name" itemprop="name">huile</p>
              <p class="site-description motion-element" itemprop="description">なthing $erious</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">huile</span>

  

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  number of visitors: <span id="busuanzi_value_site_uv"></span>
</span>
</div><br>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"live2dw/assets/","model":{"jsonPath":"/live2dw/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true}});</script></body>
</html>
